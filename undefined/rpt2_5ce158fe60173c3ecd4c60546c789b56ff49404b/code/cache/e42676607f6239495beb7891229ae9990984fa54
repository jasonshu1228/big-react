{"code":"import { reconcilerChildFibers, mountChildFibers } from './childFibers';\r\nimport { processUpdateQueue } from './updateQueue';\r\nimport { HostRoot, HostComponent, HostText } from './workTags';\r\n// 递归中的递阶段\r\n/**\r\n * 作用：1.计算状态的最新值 2. 创建子 FiberNode\r\n * @param wip 当前工作的 FiberNode 节点\r\n * @returns 返回值是子FiberNode\r\n */\r\nexport const beginWork = (wip) => {\r\n    //  将当前 FiberNode 和 ReactElement 比较，生成子FiberNode\r\n    switch (wip.tag) {\r\n        case HostRoot:\r\n            return updateHostRoot(wip);\r\n        case HostComponent:\r\n            return updateHostComponent(wip);\r\n        case HostText:\r\n            return null;\r\n        default:\r\n            if (true) {\r\n                console.warn('beginWork未实现的类型');\r\n            }\r\n            break;\r\n    }\r\n    return null;\r\n};\r\n// 计算状态的最新值，并生成 子FiberNode（会和processUpdateQueue 消费状态函数联系）\r\n// HostRootFiber\r\nfunction updateHostRoot(wip) {\r\n    // 基础的状态\r\n    const baseState = wip.memoizedState;\r\n    // 更新的状态\r\n    const updateQueue = wip.updateQueue;\r\n    // 获取参与计算的 update\r\n    const pending = updateQueue.shared.pending;\r\n    // 获取到之后把之前的 参与计算的 update 赋值 nul\r\n    updateQueue.shared.pending = null;\r\n    // memoizedState 已经是 HostRootFiber 状态的最新值了\r\n    const { memoizedState } = processUpdateQueue(baseState, pending);\r\n    wip.memoizedState = memoizedState;\r\n    // 接下来开始创建 子 FiberNode\r\n    const nextChildren = wip.memoizedState;\r\n    reconcilerChildren(wip, nextChildren);\r\n    return wip.child;\r\n}\r\n// HostComponent： div p，它的状态更新在 commit，在这里它只需要对比新老props的差异\r\n// children 在 props 属性中\r\nfunction updateHostComponent(wip) {\r\n    const nextProps = wip.pendingProps;\r\n    const nextChildren = nextProps.children;\r\n    reconcilerChildren(wip, nextChildren);\r\n    return wip.child;\r\n}\r\nfunction reconcilerChildren(wip, children) {\r\n    const current = wip.alternate;\r\n    if (current !== null) {\r\n        // update\r\n        // 将子节点的 current fiberNode 和\r\n        // 子节点的 reactElement 对比生成子节点的wip fiberNode\r\n        wip.child = reconcilerChildFibers(wip, current?.child, children);\r\n    }\r\n    else {\r\n        // mount\r\n        wip.child = mountChildFibers(wip, null, children);\r\n    }\r\n}\r\n//# sourceMappingURL=beginWork.js.map","references":["/Users/liangshuhao/Learn/coderwhy/Learn React/Big-React18-/big-react18/packages/react-reconciler/src/childFibers.ts","/Users/liangshuhao/Learn/coderwhy/Learn React/Big-React18-/big-react18/packages/shared/ReactTypes.ts","/Users/liangshuhao/Learn/coderwhy/Learn React/Big-React18-/big-react18/packages/react-reconciler/src/updateQueue.ts","/Users/liangshuhao/Learn/coderwhy/Learn React/Big-React18-/big-react18/packages/react-reconciler/src/workTags.ts","/Users/liangshuhao/Learn/coderwhy/Learn React/Big-React18-/big-react18/packages/react-reconciler/src/fiber.ts"],"map":"{\"version\":3,\"file\":\"beginWork.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../packages/react-reconciler/src/beginWork.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,qBAAqB,EAAE,gBAAgB,EAAE,MAAM,eAAe,CAAC;AAExE,OAAO,EAAE,kBAAkB,EAAe,MAAM,eAAe,CAAC;AAChE,OAAO,EAAE,QAAQ,EAAE,aAAa,EAAE,QAAQ,EAAE,MAAM,YAAY,CAAC;AAG/D,UAAU;AAEV;;;;GAIG;AACH,MAAM,CAAC,MAAM,SAAS,GAAG,CAAC,GAAc,EAAE,EAAE;IAC3C,gDAAgD;IAEhD,QAAQ,GAAG,CAAC,GAAG,EAAE;QAChB,KAAK,QAAQ;YACZ,OAAO,cAAc,CAAC,GAAG,CAAC,CAAC;QAC5B,KAAK,aAAa;YACjB,OAAO,mBAAmB,CAAC,GAAG,CAAC,CAAC;QACjC,KAAK,QAAQ;YACZ,OAAO,IAAI,CAAC;QACb;YACC,IAAI,IAAI,EAAE;gBACT,OAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;aAChC;YACD,MAAM;KACP;IACD,OAAO,IAAI,CAAC;AACb,CAAC,CAAC;AAEF,yDAAyD;AACzD,gBAAgB;AAChB,SAAS,cAAc,CAAC,GAAc;IACrC,QAAQ;IACR,MAAM,SAAS,GAAG,GAAG,CAAC,aAAa,CAAC;IACpC,QAAQ;IACR,MAAM,WAAW,GAAG,GAAG,CAAC,WAAmC,CAAC;IAC5D,iBAAiB;IACjB,MAAM,OAAO,GAAG,WAAW,CAAC,MAAM,CAAC,OAAO,CAAC;IAC3C,gCAAgC;IAChC,WAAW,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC;IAClC,0CAA0C;IAC1C,MAAM,EAAE,aAAa,EAAE,GAAG,kBAAkB,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;IACjE,GAAG,CAAC,aAAa,GAAG,aAAa,CAAC;IAElC,sBAAsB;IACtB,MAAM,YAAY,GAAG,GAAG,CAAC,aAAa,CAAC;IACvC,kBAAkB,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC;IACtC,OAAO,GAAG,CAAC,KAAK,CAAC;AAClB,CAAC;AAED,0DAA0D;AAC1D,uBAAuB;AACvB,SAAS,mBAAmB,CAAC,GAAc;IAC1C,MAAM,SAAS,GAAG,GAAG,CAAC,YAAY,CAAC;IACnC,MAAM,YAAY,GAAG,SAAS,CAAC,QAAQ,CAAC;IAExC,kBAAkB,CAAC,GAAG,EAAE,YAAY,CAAC,CAAC;IACtC,OAAO,GAAG,CAAC,KAAK,CAAC;AAClB,CAAC;AAED,SAAS,kBAAkB,CAAC,GAAc,EAAE,QAA2B;IACtE,MAAM,OAAO,GAAG,GAAG,CAAC,SAAS,CAAC;IAE9B,IAAI,OAAO,KAAK,IAAI,EAAE;QACrB,SAAS;QACT,4BAA4B;QAC5B,0CAA0C;QAC1C,GAAG,CAAC,KAAK,GAAG,qBAAqB,CAAC,GAAG,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;KACjE;SAAM;QACN,QAAQ;QACR,GAAG,CAAC,KAAK,GAAG,gBAAgB,CAAC,GAAG,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;KAClD;AACF,CAAC\"}"}
